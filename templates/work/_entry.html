{#
 # Entry template
 # -------------------
 #
 # See this page for details on how Craft routes requests:
 # http://craftcms.com/docs/routing
 #}

{% extends "_layouts/base" %}

{% import '_includes/elements' as elements %}
{% import '_includes/helpers' as helpers %}


{% block critical %}
  <style>
    {{ source(_self ~ '.min.css', ignore_missing = true) }}
  </style>
{% endblock %}


{% block main %}
  {% cache %}
  {% minify %}

  <article>

    {# -- HEADER -- #}
    <header>
      <div class="l-ctnr">
        <div class="c-header c-header--tall l-w100">
          <h1 class="c-header__title c-header__title--color">{{ entry.title | striptags() }}&ensp;</h1>
          <h2 class="c-header__subtitle">{{ entry.description | striptags() }}</h2>
        </div>
      </div>

      <div class="c-project l-ctnr l-flex">
        <div class="l-w50">
          <h3 class="c-project__header">{{ "Overview" | translate }}</h3>
          <h2 class="c-project__description">{{ entry.introduction | striptags() }}</h2>
        </div>
        <div class="l-w25">
          <h3 class="c-project__header">{{ "Involvement" | translate }}</h3>
          <ul class="c-project__tags">

            {% for tag in entry.skills %}
              <li>{{ tag.title | capitalize }}</li>
            {% endfor %}

          </ul>
        </div>
        <div class="l-w25">
          <h3 class="c-project__header">{{ "Client" | translate }}</h3>
          <p class="c-project__tags">{% if entry.client.one().website %}<a class="t-link" href="{{ entry.client.one().website }}" target="_blank" rel="noreferrer">{{ entry.client.one().title }}</a>{% else %}{{ entry.client.one().title }}{% endif %}</p>
        </div>
      </div>

    </header>

    {# -- CONTENT -- #}
    <div class="c-blocks">

      {# Body matrix #}
      {% include '_includes/blocks' %}

    </div>

    {# -- SHARE -- #}
    {% include '_includes/components/share' %}

  </article>

  {# -- RELATED ENTRIES -- #}
  {% set relatedItems = craft.entries({
    section: entry.section.handle,
    relatedTo: ['or ', entry.tags, entry.category],
    id: 'not ' ~ entry.id,
    with: 'image',
    limit: '3',
  }) %}

  {% if relatedItems | length == '3' %}

    <section class="l-ctnr">
      <div class="l-w100 l-columns">

        {# -- HEADER -- #}
        <div class="c-header">
          <h1 class="c-header__subtitle">Related projects weâ€™ve loved to make.</h1>
        </div>

        {% for item in relatedItems %}

          <article class="c-card">
            <a href="{{ item.url }}" title="{{ item.title }} for {{ item.client.one().title }}">

              {% set image = item.image[0] ?? null %}

              {% if image %}

                <figure class="c-card__image">
                  {{ elements.image(image, null, '1x1', '35rem') }}
                </figure>

              {% endif %}

              <h3 class="c-card__title">{{ item.title }}</h3>
              <p class="c-card__meta">{{ item.client.one().title }}</p>
            </a>
          </article>

        {% endfor %}

      </div>
    </section>

  {% endif %}

  {# -- PHOTOSWIPE -- #}
  {% include '_includes/photoswipe' %}

  {% endminify %}
  {% endcache %}
{% endblock %}
